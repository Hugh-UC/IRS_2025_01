services:
  lab-shell:
    container_name: lab-shell
    image: ghcr.io/hugh-uc/irs-lab-shell:humble

    # Keep the container running and allow interactive sessions
    tty: true
    stdin_open: true

    # Use host networking to join the same network space as the other containers.
    network_mode: host

    # Volume mapping remains the same and is crucial for your workflow.
    # It links your local code folder to the container's workspace.
    volumes:
      - PLACEHOLDER:/root/irslab_ws/src
      - /tmp/.X11-unix:/tmp/.X11-unix:rw
      - /etc/localtime:/etc/localtime:ro
      - /dev:/dev

    # Set the environment variables required for graphics and ROS
    environment:
      - DISPLAY
      - QT_X11_NO_MITSHM=1
      - NVIDIA_VISIBLE_DEVICES=all
      - NVIDIA_DRIVER_CAPABILITIES=all
      - ROS_DOMAIN_ID=0
      - PYTHONUNBUFFERED=1

    entrypoint: /workspace_entrypoint.sh

    privileged: true
    restart: unless-stopped
  
  # adds a volume to share local files with lab containers
  irs-simulation:
    volumes:
      - PLACEHOLDER:/root/irslab_ws/src
      - /tmp/.X11-unix:/tmp/.X11-unix:rw    # GUI related

  irs-openplc-runtime:
    volumes:
      - PLACEHOLDER:/root/irslab_ws/src
  
  # disable service
  omron_moma_ros2:
    volumes:
      - PLACEHOLDER:/root/irslab_ws/src
      - /dev:/dev
      - /tmp/.X11-unix:/tmp/.X11-unix:rw
